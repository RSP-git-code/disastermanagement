{% extends "base.html" %}
{% block title %}Country Analysis{% endblock %}
{% block content %}

<div class="container mt-5">
  <h2>ðŸ“Š Country Wise Analysis</h2>

  <!-- Country Selection Form -->
  <form method="POST">
    {% csrf_token %}
    <div class="mb-3">
      <input type="text" name="country" class="form-control" 
             list="countries_list" placeholder="Type or select a country" 
             value="{{ country|default:'' }}" required>
      <datalist id="countries_list">
        <!-- Canonical countries -->
        {% for c in countries %}
          <option value="{{ c }}">{{ c }}</option>
        {% endfor %}
        <!-- Aliases -->
        {% for alias, real in country_aliases.items %}
          <option value="{{ real }}">{{ alias|title }} (alias)</option>
        {% endfor %}
      </datalist>
    </div>
    <button type="submit" name="action" value="analyze" class="btn btn-primary">Analyze</button>
  </form>

  <!-- Error message -->
  {% if error %}
    <div class="alert alert-warning mt-2">{{ error }}</div>
  {% endif %}

  <!-- Results -->
  {% if table %}
    <div class="table-responsive mt-3">{{ table|safe }}</div>
  {% endif %}

  {% if chart %}
    <div class="mt-4">{{ chart|safe }}</div>
  {% endif %}

  <!-- Explain Graph button -->
  {% if table and chart %}
    <form method="POST" action="{% url 'explain_graph' %}" class="mt-4">
      {% csrf_token %}
      <input type="hidden" name="country" value="{{ country }}">
      <button type="submit" name="action" value="explain" class="btn btn-success">
        ðŸ§  Explain Graph
      </button>
    </form>
  {% endif %}

  <!-- Explanation (separate from form so it just displays) -->
  {% if explanation %}
    <div class="card mt-3 p-3 shadow-sm">
      <h5>ðŸ§¾ Explanation</h5>
      <p>{{ explanation }}</p>
    </div>
  {% endif %}

  <!-- Back button -->
  <div class="text-center my-4">
    <a href="{% url 'index' %}" class="btn btn-dark">â¬… Back to Home</a>
  </div>
</div>

{% endblock %}

